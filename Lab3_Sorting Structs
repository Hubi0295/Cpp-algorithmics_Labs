#include <iostream>
#include <string>
#include <fstream>
#include <sstream>

#include <cstdlib>
using namespace std;
struct student{
    string imie;
    string nazwisko;
    int punkty;
};
void quickSort(student *tablica, int lewy,int prawy, int tryb);
void wczytajStudentow(student *&tab,int *liczba_studentow);
void usunTabliceStudentow(student *&tab);
void wyswietlStudentow(student*tab,int n);

int main() {
    int tryb,liczba_studentow=0, *wsk;
    wsk=&liczba_studentow;
    cout<<"Chcesz malejaca- wcisnij 0, chcesz rosnaco wcisnij 1";
    cin>>tryb;
    student *tab2=new student[14];
    wczytajStudentow(tab2, wsk);
    wyswietlStudentow(tab2,liczba_studentow);
    quickSort(tab2,0,13,tryb);
    wyswietlStudentow(tab2,liczba_studentow);
    usunTabliceStudentow(tab2);
    return 0;
}

void quickSort(student *tablica, int lewy,int prawy, int tryb){
    int srodek=(int)(lewy+prawy)/2;
    int piwot=tablica[srodek].punkty;
    student robocza1 = tablica[srodek];
    tablica[srodek]=tablica[prawy];
    tablica[prawy]=robocza1;
    int granica = lewy;
    int i=lewy;
    while(i<prawy){
        if(tryb) {
            if(tablica[i].punkty<piwot){
                student robocza2=tablica[granica];
                tablica[granica]=tablica[i];
                tablica[i]=robocza2;
                granica+=1;
            }
        }
        else{
            if(tablica[i].punkty>piwot){
                student robocza2=tablica[granica];
                tablica[granica]=tablica[i];
                tablica[i]=robocza2;
                granica+=1;
            }
        }
        i+=1;
    }
    student robocza3 = tablica[prawy];
    tablica[prawy]=tablica[granica];
    tablica[granica]=robocza3;
    if(lewy<granica-1){
        quickSort(tablica,lewy,granica-1,tryb);
    }
    if(granica+1<prawy){
        quickSort(tablica,granica+1,prawy,tryb);
    }
}
void wczytajStudentow(student *&tab, int *liczba_studetnow){
     string sciezka,linia,pomoc;
     int liczbaStudentow;
     fstream plik;
     plik.open("studenci.csv");
     char sredniki;
     plik >> liczbaStudentow;
     for(int i = 0; i < 2; i++)
         plik >> sredniki;
     for(int i=0; i<liczbaStudentow; i++){
         plik>>linia;
         stringstream ss(linia);
         getline(ss, tab[i].imie, ';');
         getline(ss, tab[i].nazwisko, ';');
         getline(ss, pomoc);
         tab[i].punkty=atoi(pomoc.c_str());
     }
     *liczba_studetnow=liczbaStudentow;
     plik.close();
}
void usunTabliceStudentow(student *&tab){
    delete []tab;
}
void wyswietlStudentow(student*tab,int n){
    for(int i=0;i<n;i++){
        cout<<"numer:"<<i+1<<" imie:"<<tab[i].imie<<endl;
        cout<<"nazwisko:"<<tab[i].nazwisko<<endl;
        cout<<"punkty:"<<tab[i].punkty<<endl;
        cout<<endl;
    }
}
